!function(){if(g_bIsAuthenticated){const s=document.getElementById("page-noti-list"),l=(r=new SockJS("/messages"),stompClient=Stomp.over(r),stompClient),m=document.getElementById("hasread"),u=document.querySelector(".header-top-menu .noti");let f=1;async function e(){const e=await n(1);if(e.isSuccess){new Pagination({rowCount:e.totalItem,pageSize:e.limit,defaultPage:1},"#page-pagination").onChangePage(t)}}function t(e){n(e)}async function n(e=1,t=10){f=e;let n=`/api/notification/filter?page=${e}&limit=${t}&userId=${g_iUserId}`,c=document.getElementById("daterange").value,d=document.getElementById("hasread").value;if(""!=c.trim()){const e=$("#daterange").data("daterangepicker");n+="&beginDate="+e.startDate.format("YYYY-MM-DD"),n+="&endDate="+e.startDate.format("YYYY-MM-DD")}""!=d.trim()&&(n+="&hasRead="+d),toggleLoading(!0);const r=await httpClient(n);return r.isSuccess&&(s.innerHTML="",r.data.length>0?r.data.forEach(e=>{const t=generateNotificationItem(e,!1);t.addEventListener("mark",a),t.addEventListener("view",o),s.appendChild(t)}):s.appendChild(i())),toggleLoading(!1),r}function i(){const e=document.createElement("div");return e.className="notification-null",e.innerHTML="<div></div><div>Không có thông báo nào!</div>",e}function a(e){const{detail:t}=e;c(t.id,!t.hasRead,t.isSmall)}function o(e){const{detail:t}=e;c(t.id,!0,t.isSmall),window.open(t.link,"_blank");const n=document.getElementById("notification-dropdown");n&&n.remove()}async function c(e,t,n){const i=await httpClient("/api/notification","POST",{id:e,hasRead:t});if(i.isSuccess){document.querySelectorAll(`.page-notification[data-id='${e}']`).forEach(e=>{const t=generateNotificationItem(i.data,n);t.addEventListener("mark",a),t.addEventListener("view",o),e.insertAdjacentElement("afterend",t),e.remove()}),d()}}async function d(){const e=await httpClient("/api/notification/numberunread?userId="+g_iUserId);e.isSuccess&&function(e){let t=u.querySelector(".number-item");t||((t=document.createElement("span")).className="number-item",u.appendChild(t));e>=10?t.innerText="9+":e<10&&e>0?t.innerText=e:t.remove()}(e.data)}d(),l.debug=function(e){},s&&e(),m&&m.addEventListener("change",function(){e()}),u&&u.addEventListener("click",async function(){if(!u.querySelector("#notification-dropdown")){const e=document.createElement("div");e.id="notification-dropdown",e.innerHTML='<h6 class="dropdown-header">Thông báo</h6><div class="notification-list"></div><a href="/user/notification" class="view-all">Xem tất cả</a>';const t=e.querySelector(".notification-list"),n=await httpClient("/api/notification/filter?page=1&limit=5&userId="+g_iUserId);n.isSuccess&&(n.data.length>0?(t.classList.add("py-2"),n.data.forEach(e=>{const n=generateNotificationItem(e,!0);n.addEventListener("mark",a),n.addEventListener("view",o),t.appendChild(n)})):t.appendChild(i())),u.appendChild(e),setTimeout(function(){$("body").click(function(t){var n=$(t.target);n.is("#notification-dropdown")||n.is("#notification-dropdown *")||e.remove()})},0)}}),l.connect({},function(e){g_aNotificationTopics.forEach(e=>{l.subscribe("/topic/notification/"+e.id,function(e){e.body&&function(e){d();const t=document.querySelector("#notification-dropdown .notification-list");if(t){const n=t.querySelector(".notification-null");n&&n.remove();const i=t.childElementCount;5==i&&t.removeChild(t.lastElementChild);const c=generateNotificationItem(e,!0);c.addEventListener("mark",a),c.addEventListener("view",o),t.insertAdjacentElement("afterbegin",c)}if(s&&1==f){const t=s.querySelector(".notification-null");t&&t.remove();const n=s.childElementCount;10==n&&s.removeChild(s.lastElementChild);const i=generateNotificationItem(e,!1);i.addEventListener("mark",a),i.addEventListener("view",o),s.insertAdjacentElement("afterbegin",i)}}(JSON.parse(e.body))})})}),$("#daterange").daterangepicker({opens:"center",maxDate:new Date,autoUpdateInput:!1,locale:{cancelLabel:"Clear"}}),$("#daterange").on("apply.daterangepicker",function(t,n){$(this).val(n.startDate.format("DD/MM/YYYY")+" - "+n.endDate.format("DD/MM/YYYY")),e()}),$("#daterange").on("cancel.daterangepicker",function(t,n){$(this).val(""),e()})}var r}();