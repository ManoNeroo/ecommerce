!function(){const e=document.getElementById("order-search-input"),t=document.getElementById("page-pagination"),n=document.querySelector(".back-btn"),a=document.getElementById("btn-edit-cusinfo"),o=document.querySelector("#cusinfo-modal form"),r=o&&o.querySelector(".fullName-error"),i=o&&o.querySelector(".phoneNumber-error"),c=o&&o.querySelector(".address-error"),d=o&&o.querySelector("input[name='fullName']"),l=o&&o.querySelector("input[name='phoneNumber']"),s=o&&o.querySelector("input[name='address']"),u=document.querySelectorAll(".btn-cancel-order"),m=document.querySelectorAll(".btn-evaluate-order"),h=document.getElementById("evaluate-modal");(d&&d.addEventListener("focus",()=>r.innerText=""),l&&l.addEventListener("focus",()=>i.innerText=""),s&&s.addEventListener("focus",()=>c.innerText=""),a&&a.addEventListener("click",function(e){e.preventDefault(),$("#cusinfo-modal").modal("show")}),o&&o.addEventListener("submit",function(e){e.preventDefault(),function(e){let{fullName:t,phoneNumber:n,address:a}=e;t=t.trim(),n=n.trim(),a=a.trim();let o=!0;return""==t?(r.innerText="Nhập tên khách hàng!",o=!1):/^[a-z][a-z\d\s]{2,}$/gi.test(removeAccent(t))||(r.innerText="Tên khách hàng không hợp lệ!",o=!1),""==n?(i.innerText="Nhập số điện thoại!",o=!1):/^\d{10,11}$/.test(n)||(i.innerText="Số điện thoại không hợp lệ!",o=!1),""==a?(c.innerText="Nhập địa chỉ giao hàng!",o=!1):/^[\w\s\.,\\)(/-]{6,}$/i.test(removeAccent(a))||(c.innerText="Địa chỉ không hợp lệ!",o=!1),o}(getFormData(o))&&e.target.submit()}),u.forEach(e=>{e.addEventListener("click",g)}),m.forEach(e=>{e.addEventListener("click",p)}),l&&l.addEventListener("keyup",e=>{const{target:t}=e;let{value:n}=t;n=n.replace(/\D/g,""),t.value=n}),n&&n.addEventListener("click",()=>window.history.back()),t)&&new Pagination({rowCount:g_iTotalItem,pageSize:g_iPageSize,defaultPage:g_iCurrentPage},t).onChangePage(e=>{let t=window.location.origin,n=window.location.pathname,a=new URLSearchParams(window.location.search),o=t+n,r="",i=a.get("type"),c=a.get("search");null!=i&&(r+="type="+i),null!=c&&(r+=(""==r?"search=":"&search=")+c),o+="?"+(r+=(""==r?"page=":"&page=")+e),window.location.href=o});function g(e){e.preventDefault();const{target:t}=e,n=t.dataset.id;showDialog("confirm","warning","Cảnh báo","Bạn có chắc chắn hủy đơn hàng này không!").addEventListener("confirm",async function(){toggleLoading(!0);const e=await httpClient("/api/order/cancel/"+n);if(e.isSuccess)if(null!=e.data){const t=await async function(e){const t=await httpClient("/api/account/"+e);if(t.isSuccess)return t.data;return null}(e.data.userId);null!=t&&await async function(e,t,n,a,o){return await httpClient("/api/notification","POST",{content:t,link:n,topicId:a,image:o,title:e})}("Thông báo đơn hàng",`Đơn hàng <span style="font-weight: bold">${n}</span> của bạn đã bị hủy`,`/user/order/${n}`,`TOPIC_USER_${t.userName.toUpperCase()}`,"/common/mylib/img/order.png"),window.location.href="/user/order?type=4"}else window.location.reload();else showAlert("failed","Thất bại","Có lỗi xảy ra, vui lòng thử lại!");toggleLoading(!1)})}async function p(e){e.preventDefault();const{target:t}=e,n=t.dataset.id;toggleLoading(!0);const a=await httpClient("/api/order/"+n);if(console.log(a.data),a.isSuccess){const e=h.querySelector(".modal-body"),t=a.data.orderItems;t&&(e.innerHTML="",t.forEach(t=>{e.appendChild(function(e){const t=document.createElement("div");return t.className="order-item",t.innerHTML=`<a class="order-item-body" href="/product/${e.productId}#myTabContent">\n        <div class="left-side"><div class="order-avatar"><img src="${e.productAvatar}" alt="${e.productName}">\n        </div><div class="order-product"><div class="product-name">${e.productName}</div>\n        <div class="product-price">${formatNumber(e.productPromoPrice)}₫</div>\n        <div class="product-quanlity">Số lượng: ${e.quanlity}</div></div></div><div class="right-side">\n        <div class="order-item-total">${formatNumber(e.productPromoPrice*e.quanlity)}₫</div></div></a>`,t}(t))}),$("#evaluate-modal").modal("show"))}toggleLoading(!1)}e&&e.addEventListener("keyup",e=>{const{key:t}=e;if(t&&"ENTER"==t.toUpperCase()){const{value:t}=e.target;let n=window.location.origin+window.location.pathname,a="",o=new URLSearchParams(window.location.search).get("type");null!=o&&(a+="type="+o),n+="?"+(a+=(""==a?"search=":"&search=")+t),window.location.href=n}})}();