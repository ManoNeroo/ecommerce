var pagi=new Pagination({rowCount:g_iTotalItem,pageSize:g_iPageSize,defaultPage:g_iCurrentPage},"#category-pagination");pagi.onChangePage(e=>{let t=window.location.origin,n=window.location.pathname,a=new URLSearchParams(window.location.search),o=t+n,s=a.get("name"),l=a.get("status"),i="?page="+e;null!=s&&""!=s.trim()&&(i+="&name="+s),null!=l&&("true"!=(l=l.trim().toLowerCase())&&"false"!=l||(i+="&status="+l)),o+=i,window.location.href=o});const CATEGORY_MODAL_JQ=$("#category-modal"),CATEGORY_MODAL=document.getElementById("category-modal"),BTN_ADD=document.getElementById("btn-add-category"),CATEGORY_MODAL_SAVE_BTN=CATEGORY_MODAL.querySelector("#save"),CATEGORY_FORM=document.getElementById("category-form"),ID_INPUT=CATEGORY_FORM.querySelector("input[name='id']"),ENABLE_RADIO=document.getElementById("enable-status"),DISABLE_RADIO=document.getElementById("disable-status"),NAME_INPUT=CATEGORY_FORM.querySelector("input[name='name']"),LOGO_INPUT=CATEGORY_FORM.querySelector("textarea[name='logo']"),BTN_EDITS=document.querySelectorAll(".table-list .btn-edit"),BTN_TOGGLE_STATUSES=document.querySelectorAll(".table .btn-toggle-status");function handleOpenModalAdd(){checkRole(g_aUserRoles,2)||checkRole(g_aUserRoles,3)?showCategoryModal("Thêm danh mục"):showDialog("inform","danger","Thông báo","Tính năng này không dành cho tài khoản của bạn!")}function showCategoryModal(e){CATEGORY_MODAL.querySelector(".modal-title").innerText=e,CATEGORY_MODAL_JQ.modal("show")}async function handleOpenModalEdit(e){if(e.preventDefault(),checkRole(g_aUserRoles,2)||checkRole(g_aUserRoles,3)){const{target:t}=e,n=t.getAttribute("data-id"),a=await httpClient("/api/category/"+n);a.isSuccess&&showEditModal(a.data)}else showDialog("inform","danger","Thông báo","Tính năng này không dành cho tài khoản của bạn!")}function showEditModal(e){e.status?(ENABLE_RADIO.checked=!0,DISABLE_RADIO.checked=!1):(ENABLE_RADIO.checked=!1,DISABLE_RADIO.checked=!0),NAME_INPUT.value=e.name,LOGO_INPUT.value=e.logo,ID_INPUT.value=e.id,showCategoryModal("Sửa danh mục")}function handleModalHidden(){window.location.reload()}async function handleSaveCategory(){const e=getFormData(CATEGORY_FORM);if(validateForm(e))if(""!=e.id){(await httpClient("/api/category/"+e.id,"PUT",e)).isSuccess?showAlert("success","Thành công","Sửa danh mục thành công!"):showAlert("failed","Thất bại","Sửa danh mục thất bại!")}else{(await httpClient("/api/category","POST",e)).isSuccess?showAlert("success","Thành công","Thêm danh mục thành công!"):showAlert("failed","Thất bại","Thêm danh mục thất bại!")}}function validateForm(e){let{name:t,logo:n}=e;t=t.trim(),n=n.trim();const a=CATEGORY_FORM.querySelector(".name-error"),o=CATEGORY_FORM.querySelector(".logo-error");let s=!0;return/^[a-z][a-z\d\s)(]{2,}$/gi.test(removeAccent(t))||(a.innerText="Tên danh mục không hợp lệ!",s=!1),/[a-z][^a-z]*/gi.test(n)||(o.innerText="Svg path không hợp lệ!",s=!1),s}async function handleToggleStatus(e){if(e.preventDefault(),checkRole(g_aUserRoles,2)||checkRole(g_aUserRoles,3)){const{target:t}=e,n=t.getAttribute("data-id");if(t.classList.contains("btn-success")){if((await httpClient("/api/category/togglestatus?id="+n+"&status=true")).isSuccess){const e=t.parentElement.parentElement.previousElementSibling.querySelector("span");e.classList.remove("badge-warning"),e.classList.add("badge-success"),e.innerText="Enable",t.classList.remove("btn-success"),t.classList.add("btn-warning"),t.innerText="Disable"}else showAlert("failed","Thất bại","Có lỗi xảy ra!")}else{if((await httpClient("/api/category/togglestatus?id="+n+"&status=false")).isSuccess){const e=t.parentElement.parentElement.previousElementSibling.querySelector("span");e.classList.remove("badge-success"),e.classList.add("badge-warning"),e.innerText="Disable",t.classList.add("btn-success"),t.classList.remove("btn-warning"),t.innerText="Enable"}else showAlert("failed","Thất bại","Có lỗi xảy ra!")}}else showDialog("inform","danger","Thông báo","Tính năng này không dành cho tài khoản của bạn!")}function handleFocusInput(e){e.innerText=""}CATEGORY_MODAL_JQ.on("hidden.bs.modal",handleModalHidden),BTN_ADD.addEventListener("click",handleOpenModalAdd),CATEGORY_MODAL_SAVE_BTN.addEventListener("click",handleSaveCategory),NAME_INPUT.addEventListener("focus",()=>handleFocusInput(CATEGORY_FORM.querySelector(".name-error"))),LOGO_INPUT.addEventListener("focus",()=>handleFocusInput(CATEGORY_FORM.querySelector(".logo-error"))),BTN_EDITS.forEach(e=>{e.addEventListener("click",handleOpenModalEdit)}),BTN_TOGGLE_STATUSES.forEach(e=>{e.addEventListener("click",handleToggleStatus)});