!async function(){const e=document.getElementById("open-notification-dropdown"),t=(n=new SockJS("/messages"),stompClient=Stomp.over(n),stompClient);var n;const i=document.querySelector(".page-notification-list .list-body"),a=document.getElementById("hasread");let o=1;async function c(){const e=await s(1);if(e.isSuccess){new Pagination({rowCount:e.totalItem,pageSize:e.limit,defaultPage:1},"#page-pagination").onChangePage(d)}}function d(e){s(e)}async function s(e=1,t=10){o=e;let n=`/api/notification/filter?page=${e}&limit=${t}&userId=${g_iUserId}`,a=document.getElementById("daterange").value,c=document.getElementById("hasread").value;if(""!=a.trim()){const e=$("#daterange").data("daterangepicker");n+="&beginDate="+e.startDate.format("YYYY-MM-DD"),n+="&endDate="+e.startDate.format("YYYY-MM-DD")}""!=c.trim()&&(n+="&hasRead="+c),toggleLoading(!0);const d=await httpClient(n);return d.isSuccess&&(i.innerHTML="",d.data.length>0?d.data.forEach(e=>{const t=generateNotificationItem(e,!1);t.addEventListener("mark",f),t.addEventListener("view",m),i.appendChild(t)}):i.appendChild(l())),toggleLoading(!1),d}async function r(){const t=await httpClient("/api/notification/numberunread?userId="+g_iUserId);var n;t.isSuccess&&(n=t.data,e.innerHTML=n>=10?'<i class="fas fa-bell fa-fw"></i><span class="badge badge-danger badge-counter">9+</span>':n<10&&n>0?`<i class="fas fa-bell fa-fw"></i><span class="badge badge-danger badge-counter">${n}</span>`:'<i class="fas fa-bell fa-fw"></i>')}function l(){const e=document.createElement("div");return e.className="notification-null",e.innerHTML="<div></div><div>Không có thông báo nào!</div>",e}function f(e){const{detail:t}=e;u(t.id,!t.hasRead,t.isSmall)}function m(e){const{detail:t}=e;u(t.id,!0,t.isSmall),window.open(t.link,"_blank");const n=document.getElementById("notification-dropdown");n&&n.remove()}async function u(e,t,n){const i=await httpClient("/api/notification","POST",{id:e,hasRead:t});if(i.isSuccess){document.querySelectorAll(`.page-notification[data-id='${e}']`).forEach(e=>{const t=generateNotificationItem(i.data,n);t.addEventListener("mark",f),t.addEventListener("view",m),e.insertAdjacentElement("afterend",t),e.remove()}),r()}}t.debug=function(e){},r(),i&&c(),a&&a.addEventListener("change",function(){c()}),$("#daterange").daterangepicker({opens:"center",maxDate:new Date,autoUpdateInput:!1,locale:{cancelLabel:"Clear"}}),$("#daterange").on("apply.daterangepicker",function(e,t){$(this).val(t.startDate.format("DD/MM/YYYY")+" - "+t.endDate.format("DD/MM/YYYY")),c()}),$("#daterange").on("cancel.daterangepicker",function(e,t){$(this).val(""),c()}),e&&e.addEventListener("click",async function(){if(!e.nextElementSibling){const t=document.createElement("div");t.id="notification-dropdown",t.innerHTML='<h6 class="dropdown-header">Thông báo</h6><div class="notification-list"></div><a href="/admin/notification" class="view-all">Xem tất cả</a>';const n=t.querySelector(".notification-list"),i=await httpClient("/api/notification/filter?page=1&limit=5&userId="+g_iUserId);i.isSuccess&&(i.data.length>0?(n.classList.add("py-2"),i.data.forEach(e=>{const t=generateNotificationItem(e,!0);t.addEventListener("mark",f),t.addEventListener("view",m),n.appendChild(t)})):n.appendChild(l())),e.insertAdjacentElement("afterend",t),setTimeout(function(){$("body").click(function(e){var n=$(e.target);n.is("#notification-dropdown")||n.is("#notification-dropdown *")||t.remove()})},0)}}),t.connect({},function(e){g_aNotificationTopics.forEach(e=>{t.subscribe("/topic/notification/"+e.id,function(e){e.body&&function(e){r();const t=document.querySelector("#notification-dropdown .notification-list");if(t){const n=t.querySelector(".notification-null");n&&n.remove();const i=t.childElementCount;5==i&&t.removeChild(t.lastElementChild);const a=generateNotificationItem(e,!0);a.addEventListener("mark",f),a.addEventListener("view",m),t.insertAdjacentElement("afterbegin",a)}if(i&&1==o){const t=i.querySelector(".notification-null");t&&t.remove();const n=i.childElementCount;10==n&&i.removeChild(i.lastElementChild);const a=generateNotificationItem(e,!1);a.addEventListener("mark",f),a.addEventListener("view",m),i.insertAdjacentElement("afterbegin",a)}}(JSON.parse(e.body))})})})}();