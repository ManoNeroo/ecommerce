!function(){const e=document.getElementById("btn-open-modal-add"),t=document.getElementById("user-form-add"),n=$("#user-modal-add"),r=document.getElementById("user-form-edit"),a=$("#user-modal-edit"),s=document.querySelectorAll(".table .btn-toggle-status"),o=document.querySelectorAll(".table .btn-edit"),i=document.querySelector(".filter-form"),l=document.getElementById("saveAdd"),c=document.getElementById("saveEdit"),u=t&&t.querySelector("input[name='phoneNumber']"),d=r&&r.querySelector("input[name='phoneNumber']");function m(){window.location.reload()}async function h(e){e.preventDefault();const{target:t}=e,n=t.getAttribute("data-id"),a=await httpClient("/api/account/"+n);a.isSuccess&&function(e){f(e.roles.map(e=>e.id),"#form-user-roles2");const t=r.querySelector("input[name='userId']"),n=r.querySelector("input[name='firstName']"),a=r.querySelector("input[name='lastName']"),s=r.querySelector("input[name='phoneNumber']"),o=r.querySelector("#radioMale2"),i=r.querySelector("#radioFemale2");t.value=e.id,n.value=e.firstName,a.value=e.lastName,s.value=e.phoneNumber,e.gender?i.checked=!0:o.checked=!0;const l=document.querySelector("#form-user-roles2 ~ .select2-container textarea");l&&l.addEventListener("focus",()=>document.querySelector("#form-user-roles2 ~ .userRoles-error").innerText=""),$("#user-modal-edit").modal("show")}(a.data)}function g(e){const t=getFormData(e),{userName:n,firstName:r,lastName:a,phoneNumber:s,password:o,matchingPassword:i}=t,l=/^[a-z][a-z\d]{4,}$/;let c=!0;const u=e.querySelector(".userName-error"),d=e.querySelector(".firstName-error"),m=e.querySelector(".lastName-error"),h=e.querySelector(".phoneNumber-error"),g=e.querySelector(".password-error"),p=e.querySelector(".matchingPassword-error");return null!=n&&(""==n.trim()?(c=!1,u.innerText="Nhập tên đăng nhập!"):l.test(n.trim())||(c=!1,u.innerText="Tên đăng nhập không hợp lệ!")),""==r.trim()?(c=!1,d.innerText="Nhập tên họ!"):/^[a-z][a-z\d\s]{2,}$/i.test(removeAccent(r.trim()))||(c=!1,d.innerText="Tên họ không hợp lệ"),""==a.trim()?(c=!1,m.innerText="Nhập tên!"):/^[a-z][a-z\d\s]{2,}$/i.test(removeAccent(a.trim()))||(c=!1,m.innerText="Tên không hợp lệ!"),""==s.trim()?(c=!1,h.innerText="Nhập số điện thoại!"):/^(0|\+84)(\s|\.)?((3[2-9])|(5[689])|(7[06-9])|(8[1-689])|(9[0-46-9]))(\d)(\s|\.)?(\d{3})(\s|\.)?(\d{3})$/.test(s.trim())||(c=!1,h.innerText="Số điện thoại không hợp lệ!"),null!=o&&(""==o.trim()?(c=!1,g.innerText="Nhập mật khẩu!"):o.trim().length<6?(c=!1,g.innerText="Mật khẩu phải từ 6 ký tự trở lên!"):""==i.trim()?(c=!1,p.innerText="Nhập lại mật khẩu!"):i.trim()!=o.trim()&&(c=!1,p.innerText="Mật khẩu không khớp!")),c}async function p(e){e.preventDefault();const{target:t}=e,n={userId:t.getAttribute("data-id")};if(t.classList.contains("btn-success")){if(n.status=!0,(await httpClient("/api/account/togglestatus","POST",n)).isSuccess){const e=t.parentElement.previousElementSibling.querySelector("span");e.classList.remove("badge-warning"),e.classList.add("badge-success"),e.innerText="Enable",t.classList.remove("btn-success"),t.classList.add("btn-warning"),t.innerText="Disable"}else showAlert("failed","Thất bại","Có lỗi xảy ra!")}else{if(n.status=!1,(await httpClient("/api/account/togglestatus","POST",n)).isSuccess){const e=t.parentElement.previousElementSibling.querySelector("span");e.classList.remove("badge-success"),e.classList.add("badge-warning"),e.innerText="Disable",t.classList.add("btn-success"),t.classList.remove("btn-warning"),t.innerText="Enable"}else showAlert("failed","Thất bại","Có lỗi xảy ra!")}}function f(e,t){let n=[{id:2,text:"Manager"},{id:3,text:"Employee",selected:!0},{id:4,text:"Customer"}],r=[];r=null!=e?n.map(t=>{return e.some(e=>e==t.id)?{id:t.id,text:t.text,selected:!0}:{id:t.id,text:t.text}}):[...n],$(t).select2({placeholder:"Chọn quyền",allowClear:!0,data:r})}u&&u.addEventListener("keyup",e=>{const{target:t}=e;let{value:n}=t;n=n.replace(/\D/g,""),t.value=n}),d&&d.addEventListener("keyup",e=>{const{target:t}=e;let{value:n}=t;n=n.replace(/\D/g,""),t.value=n}),n.on("hidden.bs.modal",m),a.on("hidden.bs.modal",m),i&&i.addEventListener("submit",function(e){e.preventDefault();const t=getFormData(e.target);let n=window.location.origin,r=window.location.pathname,a=n+r;const s=t.search,o=t.status,i=$("#user-roles").select2("data");let l="?page=1";""!=s&&(l+="&search="+s),""!=o&&(l+="&status="+o),i.forEach((e,t)=>{l+=0==t?"&roles="+e.id:","+e.id}),a+=l,window.location.href=a}),e&&e.addEventListener("click",()=>{const e=document.querySelector("#form-user-roles1 ~ .select2-container textarea");e&&e.addEventListener("focus",()=>document.querySelector("#form-user-roles1 ~ .userRoles-error").innerText=""),$("#user-modal-add").modal("show")}),l&&l.addEventListener("click",async function(e){if(e.preventDefault(),g(t)){const e=getFormData(t);delete e["userRoles[]"];const n=$("#form-user-roles1").select2("data");if(0==n.length){const e=t.querySelector(".userRoles-error");e.innerText="Chọn quyền người dùng!"}else{e.roleIxs=[],n.forEach(t=>e.roleIxs.push(Number(t.id))),toggleLoading(!0);const t=await httpClient("/api/account","POST",e);toggleLoading(!1),t.isSuccess?showAlert("success","Thành công","Đã thêm tài khoản thành công."):showAlert("failed","Thất bại","Tài khoản đã tồn tại, vui lòng thử lại!")}}}),c&&c.addEventListener("click",async function(e){if(e.preventDefault(),g(r)){const e=getFormData(r);delete e["userRoles[]"];const t=$("#form-user-roles2").select2("data");if(0==t.length){const e=r.querySelector(".userRoles-error");e.innerText="Chọn quyền người dùng!"}else{e.roleIxs=[],t.forEach(t=>e.roleIxs.push(Number(t.id))),toggleLoading(!0);const n=await httpClient("/api/account/basicinfo/"+e.userId,"PUT",e);if(n.isSuccess){const t=await httpClient("/api/account/roles/"+e.userId,"PUT",e);t.isSuccess?showAlert("success","Thành công","Chỉnh sửa tài khoản thành công!"):showAlert("failed","Thất bại","Chỉnh sửa thất bại, vui lòng thử lại!")}else showAlert("failed","Thất bại","Chỉnh sửa thất bại, vui lòng thử lại!");toggleLoading(!1)}}}),s&&s.forEach(e=>{e.addEventListener("click",p)}),o&&o.forEach(e=>{e.addEventListener("click",h)}),t&&t.querySelectorAll(".form-control").forEach(e=>{e.addEventListener("focus",e=>{const{target:t}=e,n=t.nextElementSibling;n&&(n.innerText="")})}),r&&r.querySelectorAll(".form-control").forEach(e=>{e.addEventListener("focus",e=>{const{target:t}=e,n=t.nextElementSibling;n&&(n.innerText="")})}),new Pagination({rowCount:g_iTotalItem,pageSize:g_iPageSize,defaultPage:g_iCurrentPage},"#page-pagination").onChangePage(e=>{let t=window.location.origin+window.location.pathname,n=new URLSearchParams(window.location.search).toString();t+="?"+(n=""!=n?n.replace(/page=\d+/gi,"page="+e):"page="+e),window.location.href=t}),function(e){let t=[{id:1,text:"Admin"},{id:2,text:"Manager"},{id:3,text:"Employee"},{id:4,text:"Customer"}],n=[];n=null!=e?t.map(t=>{const n=e.some(e=>e==t.id);return n?{id:t.id,text:t.text,selected:!0}:{id:t.id,text:t.text}}):[...t];$("#user-roles").select2({placeholder:"Chọn quyền",allowClear:!0,data:n})}(g_aRoles),f(null,"#form-user-roles1")}();