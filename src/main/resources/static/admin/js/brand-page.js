var pagi=new Pagination({rowCount:g_iTotalItem,pageSize:g_iPageSize,defaultPage:g_iCurrentPage},"#brand-pagination");pagi.onChangePage(e=>{let t=window.location.origin,n=window.location.pathname,a=new URLSearchParams(window.location.search),i=t+n,s=a.get("name"),l=a.get("status"),o="?page="+e;null!=s&&""!=s.trim()&&(o+="&name="+s),null!=l&&("true"!=(l=l.trim().toLowerCase())&&"false"!=l||(o+="&status="+l)),i+=o,window.location.href=i});const BRAND_MODAL_JQ=$("#brand-modal"),BRAND_MODAL=document.getElementById("brand-modal"),BTN_ADD=document.getElementById("btn-add-brand"),BRAND_MODAL_SAVE_BTN=BRAND_MODAL.querySelector("#save"),BRAND_FORM=document.getElementById("brand-form"),ID_INPUT=BRAND_FORM.querySelector("input[name='id']"),ENABLE_RADIO=document.getElementById("enable-status"),DISABLE_RADIO=document.getElementById("disable-status"),NAME_INPUT=BRAND_FORM.querySelector("input[name='name']"),BTN_EDITS=document.querySelectorAll(".table-list .btn-edit"),BTN_TOGGLE_STATUSES=document.querySelectorAll(".table .btn-toggle-status"),BTN_CHANGE_FILE=document.querySelector("#form-file button"),FILE_LOGO_INPUT=document.querySelector("#form-file input"),LOGO_PREVIEW=document.querySelector("#form-file img");let CREATEDAT=null;function handleChangeFileLogo(e){var t=e.target,n=new FileReader;n.onload=function(){var e=n.result;LOGO_PREVIEW.src=e},n.readAsDataURL(t.files[0])}async function handleOpenModalAdd(){checkRole(g_aUserRoles,2)||checkRole(g_aUserRoles,3)?(await generateSelectOptions(),showBrandModal("Thêm thương hiệu")):showDialog("inform","danger","Thông báo","Tính năng này không dành cho tài khoản của bạn!")}async function generateSelectOptions(e=[]){const t=await httpClient("/api/category?isSortByName=true");if(t.isSuccess){let n=[];t.data.forEach(t=>{e.some(e=>e.id==t.id)?n.push({id:t.id,text:t.name,selected:!0}):n.push({id:t.id,text:t.name})}),$("#brand-category select").select2({placeholder:"Select category...",allowClear:!0,data:n})}else showAlert("failed","Lỗi","Xảy ra lỗi khi tải các danh mục!")}function showBrandModal(e){BRAND_MODAL.querySelector(".modal-title").innerText=e,BRAND_MODAL_JQ.modal("show")}async function handleOpenModalEdit(e){if(e.preventDefault(),checkRole(g_aUserRoles,2)||checkRole(g_aUserRoles,3)){const{target:t}=e,n=t.getAttribute("data-id"),a=await httpClient("/api/brand/"+n);a.isSuccess&&showEditModal(a.data)}else showDialog("inform","danger","Thông báo","Tính năng này không dành cho tài khoản của bạn!")}async function showEditModal(e){e.status?(ENABLE_RADIO.checked=!0,DISABLE_RADIO.checked=!1):(ENABLE_RADIO.checked=!1,DISABLE_RADIO.checked=!0),LOGO_PREVIEW.src=e.logo,NAME_INPUT.value=e.name,ID_INPUT.value=e.id,CREATEDAT=e.createdAt,await generateSelectOptions(e.categories),showBrandModal("Sửa thương hiệu")}function handleModalHidden(){window.location.reload()}async function handleSaveBrand(){const e=getFormData(BRAND_FORM);if(validateForm(e)){let t;if(FILE_LOGO_INPUT.files.length>0){const e=new FormData;e.append("file",FILE_LOGO_INPUT.files[0]);const n=await httpClient("/api/upload","POST",e);n.isSuccess?t=n.data:showAlert("failed","Lỗi","Có lỗi xảy ra trong quá trình upload file!")}else t=LOGO_PREVIEW.src;if(t){const n=$("#brand-category select").select2("data").map(e=>Number(e.id));if(""!=e.id){const a={id:e.id,name:e.name,logo:t,status:e.status,categoryIds:n,createdAt:CREATEDAT};(await httpClient("/api/brand/"+e.id,"PUT",a)).isSuccess?showAlert("success","Thành công","Sửa thương hiệu thành công!"):showAlert("failed","Thất bại","Sửa thương hiệu thất bại!")}else{const a={name:e.name,logo:t,status:e.status,categoryIds:n};(await httpClient("/api/brand","POST",a)).isSuccess?showAlert("success","Thành công","Đã thêm thương hiệu thành công!"):showAlert("failed","Thất bại","Thêm thương hiệu thất bại!")}}}}function validateForm(e){let{name:t}=e;t=t.trim();const n=BRAND_FORM.querySelector(".name-error");let a=!0;return/^[a-z][a-z\d\s)(]{2,}$/gi.test(removeAccent(t))||(n.innerText="Tên thương hiệu không hợp lệ!",a=!1),a}async function handleToggleStatus(e){if(e.preventDefault(),checkRole(g_aUserRoles,2)||checkRole(g_aUserRoles,3)){const{target:t}=e,n=t.getAttribute("data-id");if(t.classList.contains("btn-success")){if((await httpClient("/api/brand/togglestatus?id="+n+"&status=true")).isSuccess){const e=t.parentElement.parentElement.previousElementSibling.querySelector("span");e.classList.remove("badge-warning"),e.classList.add("badge-success"),e.innerText="Enable",t.classList.remove("btn-success"),t.classList.add("btn-warning"),t.innerText="Disable"}else showAlert("failed","Thất bại","Có lỗi xảy ra!")}else{if((await httpClient("/api/brand/togglestatus?id="+n+"&status=false")).isSuccess){const e=t.parentElement.parentElement.previousElementSibling.querySelector("span");e.classList.remove("badge-success"),e.classList.add("badge-warning"),e.innerText="Disable",t.classList.add("btn-success"),t.classList.remove("btn-warning"),t.innerText="Enable"}else showAlert("failed","Thất bại","Có lỗi xảy ra!")}}else showDialog("inform","danger","Thông báo","Tính năng này không dành cho tài khoản của bạn!")}function handleFocusInput(e){e.innerText=""}BTN_CHANGE_FILE.addEventListener("click",e=>{e.preventDefault(),FILE_LOGO_INPUT.click()}),FILE_LOGO_INPUT.addEventListener("change",handleChangeFileLogo),BRAND_MODAL_JQ.on("hidden.bs.modal",handleModalHidden),BTN_ADD.addEventListener("click",handleOpenModalAdd),BRAND_MODAL_SAVE_BTN.addEventListener("click",handleSaveBrand),NAME_INPUT.addEventListener("focus",()=>handleFocusInput(BRAND_FORM.querySelector(".name-error"))),BTN_EDITS.forEach(e=>{e.addEventListener("click",handleOpenModalEdit)}),BTN_TOGGLE_STATUSES.forEach(e=>{e.addEventListener("click",handleToggleStatus)});