const FILTER_FORM=document.querySelector(".filter-form"),BTN_TOGGLE_STATUSES=document.querySelectorAll(".table .btn-toggle-status");FILTER_FORM.addEventListener("submit",handleFilterProduct),BTN_TOGGLE_STATUSES.forEach(e=>{e.addEventListener("click",handleToggleStatus)});var pagi=new Pagination({rowCount:g_iTotalItem,pageSize:g_iPageSize,defaultPage:g_iCurrentPage},"#page-pagination");function handleFilterProduct(e){e.preventDefault();let t=window.location.origin+window.location.pathname,a=FILTER_FORM.querySelector("select[name='status']").value.trim(),n=FILTER_FORM.querySelector("select[name='isSort']").value.trim(),i=FILTER_FORM.querySelector("input[name='name']").value.trim(),s=$("#category").select2("data"),l=$("#brand").select2("data"),r=$("#priceRange").select2("data"),o="?page=1";""!=i&&(o+="&name="+i),""!=a&&(o+="&status="+a),""!=n&&(o+="&isSort="+n),s.forEach((e,t)=>{o+=0==t?"&category="+e.id:","+e.id}),l.forEach((e,t)=>{o+=0==t?"&brand="+e.id:","+e.id}),r.forEach((e,t)=>{o+=0==t?"&priceRange="+e.id:","+e.id}),t+=o,window.location.href=t}function generateSelectPriceRangeOptions(e){let t=[{id:0,text:"Dưới 10,000,000"},{id:1,text:"10,000,000 - 15,000,000"},{id:2,text:"15,000,000 - 20,000,000"},{id:3,text:"20,000,000 - 25,000,000"},{id:4,text:"Trên 25,000,000"}],a=[];a=null!=e?t.map(t=>{return e.some(e=>e==t.id)?{id:t.id,text:t.text,selected:!0}:{id:t.id,text:t.text}}):[...t],$("#priceRange").select2({placeholder:"Chọn mức giá",allowClear:!0,data:a})}async function handleToggleStatus(e){if(e.preventDefault(),checkRole(g_aUserRoles,2)||checkRole(g_aUserRoles,3)){const{target:t}=e,a=t.getAttribute("data-id");if(t.classList.contains("btn-success")){if((await httpClient("/api/product/togglestatus","PATCH",{productId:a,status:!0})).isSuccess){const e=t.parentElement.previousElementSibling.querySelector("span");e.classList.remove("badge-warning"),e.classList.add("badge-success"),e.innerText="Enable",t.classList.remove("btn-success"),t.classList.add("btn-warning"),t.innerText="Disable"}else showAlert("failed","Thất bại","Có lỗi xảy ra!")}else{if((await httpClient("/api/product/togglestatus","PATCH",{productId:a,status:!1})).isSuccess){const e=t.parentElement.previousElementSibling.querySelector("span");e.classList.remove("badge-success"),e.classList.add("badge-warning"),e.innerText="Disable",t.classList.add("btn-success"),t.classList.remove("btn-warning"),t.innerText="Enable"}else showAlert("failed","Thất bại","Có lỗi xảy ra!")}}else showDialog("inform","danger","Thông báo","Tính năng này không dành cho tài khoản của bạn!")}function generateSelectBrandOptions(e,t){e=e.map(e=>({id:e.id,text:e.name}));let a=[];a=null!=t?e.map(e=>{return t.some(t=>t==e.id)?{id:e.id,text:e.text,selected:!0}:{id:e.id,text:e.text}}):[...e],$("#brand").select2({placeholder:"Chọn thương hiệu",allowClear:!0,data:a})}function generateSelectCategoryOptions(e,t){e=e.map(e=>({id:e.id,text:e.name}));let a=[];a=null!=t?e.map(e=>{return t.some(t=>t==e.id)?{id:e.id,text:e.text,selected:!0}:{id:e.id,text:e.text}}):[...e],$("#category").select2({placeholder:"Chọn danh mục",allowClear:!0,data:a})}pagi.onChangePage(e=>{let t=window.location.origin+window.location.pathname,a=new URLSearchParams(window.location.search).toString();t+="?"+(a=""!=a?a.replace(/page=\d+/gi,"page="+e):"page="+e),window.location.href=t}),generateSelectPriceRangeOptions(g_iPriceRangeIxs),generateSelectBrandOptions(g_aBrands,g_aSearchBrandIds),generateSelectCategoryOptions(g_aCategories,g_aSearchCategoryIds);