class ImageList{constructor(e){1!==e.nodeType&&(e=document.querySelector(e)),this.element=initImageList(e),this.element.querySelector(".image-item-upload").addEventListener("click",handleClickAddImage.bind(this))}onAddImage(e){this.element.addEventListener("addImage",()=>{e()})}onEditImage(e){this.element.addEventListener("editImage",t=>{e(t.detail.itemId)})}onRemoveImage(e){this.element.addEventListener("removeImage",t=>{e(t.detail.itemId)})}clearImages(){this.element.innerHTML="";const e=document.createElement("div"),t=document.createElement("div"),a=document.createElement("span");e.className="image-item col-md-3 col-sm-4",t.className="image-item-wrapper",a.className="image-item-upload",a.innerHTML='<svg viewBox="0 0 24 24">\n                            <path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"></path>\n                            </svg>',t.appendChild(a),e.appendChild(t),this.element.appendChild(e),a.addEventListener("click",handleClickAddImage.bind(this))}setImages(e){Array.isArray(e)&&e.forEach(e=>{this.addImage(e)})}removeImage(e){const t=this.element.querySelector(`.image-item[data-id='${e}']`);t&&t.remove()}addImage(e){if(e&&e.hasOwnProperty("id")&&e.hasOwnProperty("name")){const t=initImageItem(e);this.element.appendChild(t);const a=t.querySelector(".btn-edit"),n=t.querySelector(".btn-delete");a.addEventListener("click",handleClickEditImage.bind(this)),n.addEventListener("click",handleClickRemoveImage.bind(this))}}editImage(e){if(e&&e.hasOwnProperty("id")&&e.hasOwnProperty("name")){const t=this.element.querySelector(`.image-item[data-id='${e.id}']`);if(t){t.querySelector("img").src=e.name}}}}function handleClickAddImage(){const e=new Event("addImage");this.element.dispatchEvent(e)}function handleClickEditImage(e){const{target:t}=e;let a=t.parentElement.parentElement;"svg"==t.nodeName?a=a.parentElement:"path"==t.nodeName&&(a=a.parentElement.parentElement);const n=new CustomEvent("editImage",{detail:{itemId:a.dataset.id}});this.element.dispatchEvent(n)}function handleClickRemoveImage(e){const{target:t}=e;let a=t.parentElement.parentElement;"svg"==t.nodeName?a=a.parentElement:"path"==t.nodeName&&(a=a.parentElement.parentElement);const n=new CustomEvent("removeImage",{detail:{itemId:a.dataset.id}});this.element.dispatchEvent(n)}function initImageItem(e){const t=document.createElement("div"),a=document.createElement("div"),n=document.createElement("div"),i=document.createElement("img"),d=document.createElement("button"),m=document.createElement("button");n.className="overlay",d.className="btn-edit",d.type="button",d.innerHTML='<svg viewBox="0 0 24 24">\n                            <path\n                                d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 00-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z">\n                            </path>\n                            </svg>',m.className="btn-delete",m.type="button",m.innerHTML='<svg viewBox="0 0 24 24">\n                            <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"></path>\n                            </svg>',t.className="image-item col-md-3 col-sm-4",a.className="image-item-wrapper",i.src=e.name,t.setAttribute("data-id",e.id),a.append(i,n,d,m),t.appendChild(a);const c=i.height;return i.width>c?i.style.width="96%":i.style.height="16em",t}function initImageList(e){const t=document.createElement("div"),a=document.createElement("div"),n=document.createElement("div"),i=document.createElement("span");return t.className="row",a.className="image-item col-md-3 col-sm-4",n.className="image-item-wrapper",i.className="image-item-upload",i.innerHTML='<svg viewBox="0 0 24 24">\n                            <path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"></path>\n                            </svg>',n.appendChild(i),a.appendChild(n),t.appendChild(a),e.appendChild(t),t}const PICTURE_TAB=document.getElementById("picture-nav");PICTURE_TAB.addEventListener("click",handleClickPictureTab);const imageList=new ImageList("#image-list");async function handleClickPictureTab(){const e=BASIC_FORM.querySelector("input[name='id']").value,t=await httpClient("/api/productpicture/product/"+e);imageList.clearImages(),t.isSuccess?null!=t.data&&imageList.setImages(t.data):showAlert("failed","Lỗi","Có lỗi xảy ra khi tải ảnh của sản phẩm!")}function handleSaveProductPicture(e){(new uploadModal).onUpload(async t=>{const a={name:t,productId:BASIC_FORM.querySelector("input[name='id']").value};e&&(a.id=e);const n=await httpClient("/api/productpicture","POST",a);n.isSuccess?e?imageList.editImage(n.data):imageList.addImage(n.data):showAlert("failed","Lỗi","Có lỗi xảy ra, vui lòng thử lại!")})}async function handleDeleteProductPicture(e){if(window.confirm("Xác nhận xóa ảnh!")){(await httpClient("/api/productpicture/"+e,"DELETE")).isSuccess?imageList.removeImage(e):showAlert("failed","Lỗi","Có lỗi xảy ra, vui lòng thử lại!")}}imageList.onEditImage(handleSaveProductPicture),imageList.onRemoveImage(handleDeleteProductPicture),imageList.onAddImage(handleSaveProductPicture);