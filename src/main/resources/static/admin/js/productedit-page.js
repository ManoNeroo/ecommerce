const BTN_CHANGE_FILE=document.querySelector("#form-file button"),AVATAR_PREVIEW=document.querySelector("#form-file img"),BASIC_FORM=document.getElementById("basic-form"),NAME_INPUT=BASIC_FORM.querySelector("input[name='name']"),PRICE_INPUT=BASIC_FORM.querySelector("input[name='price']"),PRICEOFF_INPUT=BASIC_FORM.querySelector("input[name='priceOff']"),QUANLITY_INPUT=BASIC_FORM.querySelector("input[name='quanlity']"),NAME_ERROR=BASIC_FORM.querySelector(".name-error"),PRICE_ERROR=BASIC_FORM.querySelector(".price-error"),PRICEOFF_ERROR=BASIC_FORM.querySelector(".priceoff-error"),QUANLITY_ERROR=BASIC_FORM.querySelector(".quanlity-error");function handleChangeFileAvatar(e){e.preventDefault();const t=BTN_CHANGE_FILE.dataset.id;(new uploadModal).onUpload(async e=>{(await httpClient("/api/product/avatar","PATCH",{id:t,avatar:e})).isSuccess?AVATAR_PREVIEW.src=e:showAlert("failed","Thất bại","Đã xảy ra lỗi, vui lòng thử lại!")})}async function generateSelectOptions(e,t){const n=await httpClient("/api/"+e);if(n.isSuccess){let r=e+"Id";const a=BASIC_FORM.querySelector(`select[name='${r}']`);n.data.forEach(e=>{const n=document.createElement("option");n.value=e.id,n.text=e.name,e.id==t&&(n.selected=!0),a.appendChild(n)})}}async function handleSaveProduct(e){e.preventDefault();const t=getFormData(BASIC_FORM);if(validateForm(t)){const e={id:t.id,brandId:Number(t.brandId),categoryId:Number(t.categoryId),name:t.name,status:JSON.parse(t.status),quanlity:Number(t.quanlity.replace(/,/g,"")),price:Number(t.price.replace(/,/g,"")),priceOff:Number(t.priceOff.replace(/,/g,""))};(await httpClient("/api/product/"+t.id,"PUT",e)).isSuccess?showAlert("success","Thành công","Cập nhật sản phẩm thành công!"):showAlert("failed","Lỗi","Thêm sản phẩm thất bại!")}}function validateForm(e){let{name:t,price:n,quanlity:r,priceOff:a}=e;t=t.trim(),n=n.replace(/,/g,""),a=a.replace(/,/g,""),r=r.replace(/,/g,"");let i=!0;return""==t?(NAME_ERROR.innerText="Nhập tên sản phẩm!",i=!1):/^[a-z][a-z\d\s\\)(/-]{2,}$/gi.test(removeAccent(t))||(NAME_ERROR.innerText="Tên sản phẩm không hợp lệ!",i=!1),""==n&&(PRICE_ERROR.innerText="Nhập giá sản phẩm!",i=!1),""==r&&(QUANLITY_ERROR.innerText="Nhập số lượng sản phẩm!",i=!1),Number(a)>Number(n)&&(PRICEOFF_ERROR.innerText="Giá khuyến mãi không hợp lệ!",i=!1),i}NAME_INPUT.addEventListener("focus",()=>NAME_ERROR.innerText=""),PRICE_INPUT.addEventListener("focus",()=>PRICE_ERROR.innerText=""),PRICEOFF_INPUT.addEventListener("focus",()=>PRICEOFF_ERROR.innerText=""),QUANLITY_INPUT.addEventListener("focus",()=>QUANLITY_ERROR.innerText=""),BTN_CHANGE_FILE.addEventListener("click",handleChangeFileAvatar),BASIC_FORM.addEventListener("submit",handleSaveProduct),numberInput(),generateSelectOptions("category",g_iCategoryId),generateSelectOptions("brand",g_iBrandId);